\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{tetsu_physics}

\newif\ifideographic@
\DeclareOption{ideographic}{\ideographic@true}
\ProcessOptions*

\usepackage{amsmath, amssymb, amsthm, amscd}
\usepackage{manfnt, mathrsfs}
\usepackage[version=4]{mhchem}
\usepackage{chemfig}
\usepackage{fancyhdr}
\usepackage{caption}
\usepackage{cases}
\usepackage{wrapfig}
\usepackage{titlesec}
\usepackage{eqnum_extended, enumitem_extended, Fcntr, uw, figcap_ext}
\usepackage{tikz}
\usetikzlibrary{intersections, calc, arrows, decorations.pathmorphing, decorations.markings, patterns, angles, quotes}
\usepackage[nooldvoltagedirection, straightvoltages, europeanresistors, cuteinductors, straightlabels]{circuitikz}

% titilesec paragraph
\renewcommand{\jsParagraphMark}{■}
\if@twocolumn
  \renewcommand{\paragraph}{\@startsection{paragraph}{4}{\z@}%
    {\z@}{\if@slide .4\Cvs \else -1zw\fi}% 改行せず 1zw のアキ
    {\normalfont\normalsize\headfont\jsParagraphMark}}
\else
  \renewcommand{\paragraph}{\@startsection{paragraph}{4}{\z@}%
    {0.5\Cvs \@plus.5\Cdp \@minus.2\Cdp}%
    {\if@slide .5\Cvs \@plus.3\Cdp \else -1zw\fi}% 改行せず 1zw のアキ
    {\normalfont\normalsize\headfont\jsParagraphMark}}
\fi

% enumerate indent and sep
\ifideographic@\setlist{leftmargin=2zw, topsep=1zw, itemsep=.5zw, listparindent=1zw, labelsep=1zw, itemindent=1zw}\fi

% MWEs: /usr/local/texlive/2020/texmf-dist/tex/generic/circuitikz/
% capacitor width
\newcommand\Cwidth{bipoles/capacitor/width/.initial}

% wavy capacitor
\ctikzset{bipoles/wcapacitor/height/.initial=.3}
\ctikzset{bipoles/wcapacitor/width/.initial=.12}
\ctikzset{bipoles/wcapacitor/bend width/.initial=.6}
%
\def\pgf@circ@wcapacitor@path#1{\pgf@circ@bipole@path{wcapacitor}{#1}}
\compattikzset{wavy capacitor/.style = {\circuitikzbasekey, /tikz/to path=\pgf@circ@wcapacitor@path, l=#1}}
%
\pgfcircdeclarebipolescaled{capacitors}
{}
{\ctikzvalof{bipoles/wcapacitor/height}}
{wcapacitor}
{\ctikzvalof{bipoles/wcapacitor/height}}
{\ctikzvalof{bipoles/wcapacitor/width}}
{
  \pgf@circ@setlinewidth{bipoles}{\pgfstartlinewidth}

  \pgfscope
    \pgfsetlinewidth{.5pt}
    \pgfpathmoveto{\pgfpoint{\pgf@circ@res@left}{\pgf@circ@res@up}}
    \pgftransformrotate{-90}
    \pgfpathsine{\pgfpoint{0.5\pgf@circ@res@up}{-\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@right}}
    \pgfpathcosine{\pgfpoint{0.5\pgf@circ@res@up}{\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@right}}
    \pgfpathsine{\pgfpoint{0.5\pgf@circ@res@up}{-\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@left}}
    \pgfpathcosine{\pgfpoint{0.5\pgf@circ@res@up}{\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@left}}
    \pgfusepath{draw}
  \endpgfscope

  \pgfscope
    \pgfsetlinewidth{.5pt}
    \pgfpathmoveto{\pgfpoint{\pgf@circ@res@right}{\pgf@circ@res@up}}
    \pgftransformrotate{-90}
    \pgfpathsine{\pgfpoint{0.5\pgf@circ@res@up}{-\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@right}}
    \pgfpathcosine{\pgfpoint{0.5\pgf@circ@res@up}{\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@right}}
    \pgfpathsine{\pgfpoint{0.5\pgf@circ@res@up}{-\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@left}}
    \pgfpathcosine{\pgfpoint{0.5\pgf@circ@res@up}{\ctikzvalof{bipoles/wcapacitor/bend width}\pgf@circ@res@left}}
    \pgfusepath{draw}
  \endpgfscope
}

% capacitor
\newcommand{\drawCapa}{\@ifstar{\@drawCapa}{\@@drawCapa}}
\newcommand{\@drawCapa}[3]{%
  \begin{scope}
    \draw #1 to [capacitor, \Cwidth=0.4, name=c@p@] #2;
    \draw (c@p@.center) node {#3};
  \end{scope}
}
\newcommand{\@@drawCapa}[5][r]{%
  \ifx#1r%
    \begin{scope}
      \draw #2 to [capacitor, \Cwidth=0.4, name=c@p@] #3;
      \draw (c@p@.center) node {#4};
      \draw (c@p@.north east) node [right] {$+$#5};
      \draw (c@p@.north west) node [left] {$-$#5};
    \end{scope}
  \fi
  \ifx#1l%
    \begin{scope}
      \draw #2 to [capacitor, \Cwidth=0.4, name=c@p@] #3;
      \draw (c@p@.center) node {#4};
      \draw (c@p@.north east) node [right] {$-$#5};
      \draw (c@p@.north west) node [left] {$+$#5};
    \end{scope}
  \fi
  \ifx#1u%
    \begin{scope}
      \draw #2 to [capacitor, \Cwidth=0.4, name=c@p@] #3;
      \draw (c@p@.center) node {#4};
      \draw (c@p@.south east) node [right] {$+$#5};
      \draw (c@p@.south west) node [right] {$-$#5};
    \end{scope}
  \fi
  \ifx#1d%
    \begin{scope}
      \draw #2 to [capacitor, \Cwidth=0.4, name=c@p@] #3;
      \draw (c@p@.center) node {#4};
      \draw (c@p@.south east) node [right] {$-$#5};
      \draw (c@p@.south west) node [right] {$+$#5};
    \end{scope}
  \fi
}

% Alternative current Voltage Source
\def\pgf@circ@ACV@path#1{\pgf@circ@bipole@path{ACV}{#1}}
\compattikzset{ACV/.style = {\circuitikzbasekey, /tikz/to path=\pgf@circ@ACV@path, label=#1}}

\pgfcircdeclarebipole{} % independent sinusoidal current source
    {\ctikzvalof{bipoles/isourcesin/height}}
    {ACV}
    {\ctikzvalof{bipoles/isourcesin/height}}
    {\ctikzvalof{bipoles/isourcesin/width}}
    {
        \pgfpointorigin
        \pgfsetlinewidth{\pgfkeysvalueof{/tikz/circuitikz/bipoles/thickness}\pgfstartlinewidth}
        \pgfpathellipse{\pgfpointorigin}{\pgfpoint{0}{\pgf@circ@res@up}}{\pgfpoint{\pgf@circ@res@left}{0}}
        \pgfusepath{draw}
        \pgf@circ@res@up = .5\pgf@circ@res@up
        \pgfscope
            \pgfpathmoveto{\pgfpoint{-\pgf@circ@res@up}{0cm}}
            \pgfpathsine{\pgfpoint{.5\pgf@circ@res@up}{.5\pgf@circ@res@up}}
            \pgfpathcosine{\pgfpoint{.5\pgf@circ@res@up}{-.5\pgf@circ@res@up}}
            \pgfpathsine{\pgfpoint{.5\pgf@circ@res@up}{-.5\pgf@circ@res@up}}
            \pgfpathcosine{\pgfpoint{.5\pgf@circ@res@up}{.5\pgf@circ@res@up}}
            \pgfusepath{draw}
        \endpgfscope

        \pgfpathmoveto{\pgfpoint{.7\pgf@circ@res@left}{\pgf@circ@res@zero}}
        \pgfpathlineto{\pgfpoint{.7\pgf@circ@res@right}{\pgf@circ@res@zero}}
    }
